          INSTRUCTIONS FOR EXECUTING THE IMAPP MODIS FLAT FILE
           EXTRACTORS STANDALONE SOFTWARE FOR DIRECT BROADCAST
                         Updated March 2009
    ----------------------------------------------------------
     These FORTRAN routines create binary flat files and header 
     files in ENVI readable format from input L1B 1km, 500m, 250m, 
     and geolocation MODIS Direct Broadcast or DAAC formatted HDF files.  
     The binary files can then be used as input for IMAPP MODIS 
     direct broadcast Level 2 products.  The software will extract
     the data into either radiances or reflectances (normalized 
     radiances - values not divided by the cosine of the solar 
     zenith angle).  

     This code can be run as part of the total IMAPP MODIS
     Level 2 package (imapp_modisl2/scripts/modis_level2.csh).
     We strongly suggest that you use this automated script.
     If you wish to ONLY produce the flat file products, then you
     can simply rename the executables in the /imapp_modisl2/bin
     directory that you do not wish to run.   You could, for example,
     rename the profiles.exe, wvnir.exe, cloudtop.exe, sst.exe,
     aerosol.exe cloudmask.exe files and still use the
     imapp_modisl2/scripts/modis_level2.csh script to produce
     the flat file binary output files.

     If you do not wish to use the automated script then
     this file describes the procedure to run the flat file software 
     individual executables.  Please read the 
     top level MODIS Level 2 00README file which contains information
     about the entire MODIS Level 2 package prior to reading this
     flat file specific file.
     --------------------------------------------------------

Routine Name                 Input         Platform    Output data
-----------                ----------      --------    -----------
modis_extract_1km.exe    L1b 1km hdf file  SatName  1km flat file and header
                                                         file
modis_extract_met.exe    L1b 1km hdf file  SatName  Scan based meta file and
                                                         header file
modis_extract_hkm.exe    L1b 500m hdf file  SatName  500m flat file and header
                                                         file
modis_extract_qkm.exe    L1b 250m hdf file  SatName  250m flat file and header
                                                         file
modis_extract_geo.exe    L1b geo. hdf file  SatName  Geolocation flat file and
                                                         header file

     Because the files are created following the ENVI header format,
     these files can be viewed and compared using ITT's ENVI tool
     (http://www.ittvis.com/envi/).

     A detailed description of the contents of the output files
     can be found in the imapp_modisl2/doc/Flatfile_Output_Description.txt 
     file. The flat file header files also describe the output file formats.

--------------------------------------------------------------------------

Instructions for running the MODIS flat file software

Platform requirements:

   The MODIS flat file software has been compiled and executed 
   successfully on the following platforms:

      The software has been compiled and executed successfully on the following
       Linux operating systems using the g77 gnu (gcc 3.2.1) compiler:

      Red Hat Linux x86 7.2, Red Hat Enterprise Linux 3 x86_64
         and Linux CentOS 4.2 x86_64 on Sun Operton platforms

Software Requirements:

   (1) HDF libraries must be installed.  A version that has been
       tested on the supported platforms is included with this
       imapp release, in the /imapp_modisl2/hdf directory.  
       The HDF libraries can be obtained in pre-compiled binary form from:

         http://www.hdfgroup.org/release4/obtain.html

       If you intend to use the make files to compile the software,
       you will need to set the HDF_HOME environmental variable
       prior to execution of the make file.  HDF_HOME is one of the
       variables that can be set by executing one of the environmental
       variable scripts located in the imapp_modisl2/env directory.

Installation:
   (1) Download the full IMAPP Level 2 package from:

        http://cimss.ssec.wisc.edu/imapp/ 

       and upack the tar file as descibed in the README file
       that accompanies the software release.

   (2) Build the executables, if you choose to.  Statically linked
       binary executables tested on the supported platforms are located 
       within the imapp_modisl2/bin directory.  A make file for the
       flat file software is located in the /imapp_modisl2/src/flatfile/src
       directory.  It will attempt to use standard compilers for
       detected platforms to build the executables.  To use this
       make file, within the imapp_modisl2/src/flatfile/src directory,
       type make.  It will attempt to build these files:

          modis_extract_1km.exe
          modis_extract_geo.exe
          modis_extract_hkm.exe
          modis_extract_met.exe
          modis_extract_qkm.exe

       To build other executables, please see the README files that
       are located with each inidividual software unit located in the
       imapp_modisl2/src directory.
       
Run:

   (1) To use the preconfigured test Terra data set, follow the
       instructions in the main top level 00README file
       to unpack the test input and output data sets. You may
       choose to unpack them into the imapp_modisl2/input_data
       directory.  This will unpack all of the required input
       files needed to create the MODIS level2 IMAPP flatfile
       products:

          t1.09084.1512.1000m.hdf    -  Terra MODIS 1km L1B input file
          t1.09084.1512.250m.hdf     -  Terra MODIS 250m L1B input file
          t1.09084.1512.500m.hdf     -  Terra MODIS 500m L1B input file
          t1.09084.1512.geo.hdf      -  Terra MODIS 1km geolocation file

       To execute the 1 km extractor
         Usage: modis_extract_1km.exe  in_hdf sat_name out_img out_hdr
                where
         in_hdf:  name of input MOD021KM HDF file
         sat_name: MODIS satellite platform name (Aqua or Terra)
         out_img: name of output image file (.img extension)
         out_hdr: name of output header file (.hdr extension)

       For our test data set you would type from the 
       imapp_modisl2/src/flatfile/src directory:

      modis_extract_1km.exe ../../../input_data/t1.09084.1512.1000m.hdf Terra t1.09084.1512.1000m.img t1.09084.1512.1000m.hdr

       To execute the 500 m extractor
         Usage: modis_extract_hkm.exe in_hdf sat_name out_img out_hdr
                where
         in_hdf:  name of input MOD02HKM HDF file
         sat_name: MODIS satellite platform name (Aqua or Terra)
         out_img: name of output image file (.img extension)
         out_hdr: name of output header file (.hdr extension)

       For our test data set you would type:
      modis_extract_hkm.exe ../../../input_data/t1.09084.1512.500m.hdf Terra t1.09084.1512.500m.img t1.09084.1512.500m.hdr

       To execute the 250 m extractor
         Usage: modis_extract_qkm.exe in_hdf sat_name out_img out_hdr
                where
         in_hdf:  name of input MOD02QKM HDF file
         sat_name: MODIS satellite platform name (Aqua or Terra)
         out_img: name of output image file (.img extension)
         out_hdr: name of output header file (.hdr extension)

       For our test data set you would type:
      modis_extract_qkm.exe ../../../input_data/t1.09084.1512.250m.hdf Terra t1.09084.1512.250m.img t1.09084.1512.250m.hdr

       To execute the met data extractor - extracts scan type and
           mirror side information
         Usage: modis_extract_met.exe in_hdf sat_name out_img out_hdr
                where
         in_hdf:  name of input MOD021KM HDF file
         sat_name: MODIS satellite platform name (Aqua or Terra)
         out_img: name of output image file (.img extension)
         out_hdr: name of output header file (.hdr extension)

       For our test data set you would type:
      modis_extract_met.exe ../../../input_data/t1.09084.1512.1000m.hdf Terra t1.09084.1512.met.img t1.09084.1512.met.hdr

       To execute the geolocation data extractor 
         Usage: modis_extract_geo.exe in_hdf sat_name out_img out_hdr
                where
         in_hdf:  name of input MOD03 HDF file
         sat_name: MODIS satellite platform name (Aqua or Terra)
         out_img: name of output image file (.img extension)
         out_hdr: name of output header file (.hdr extension)

       For our test data set you would type:
      modis_extract_geo.exe ../../../input_data/t1.09084.1512.geo.hdf Terra t1.09084.1512.geo.img t1.09084.1512.geo.hdr

       These are the extracted flat files that you will have if you use
       the above commands and the test input data files:

       t1.09084.1512.1000m.hdr
          MODIS extracted Level 1B 1km header file 
       t1.09084.1512.1000m.img
          MODIS extracted Level 1B 1km binary image file 
       t1.09084.1512.250m.hdr
          MODIS extracted Level 1B 250m header file
       t1.09084.1512.250m.img
          MODIS extracted Level 1B 250m binary image file
       t1.09084.1512.met.hdr 
          MODIS extracted Level 1B met header file
       t1.09084.1512.met.img
          MODIS extracted Level 1B met binary image file (scan type and mirror side info)
       t1.09084.1512.geo.hdr
          MODIS extracted geolocation header file
       t1.09084.1512.geo.img
          MODIS extracted geolocation binary image file

Output file descriptions:
       
       See the Flatfile_Output_Description.txt file located within
       the imapp_modisl2/doc directory.  The .hdr files will also 
       contain output file format information.

Verifying the IMAPP MODIS flatfile direct broadcast product output.

       An example benchmark output file is included in the
       test input and output tar file that accompanies
       this release:

       t1.09084.1512.1000m.hdr
          MODIS extracted Level 1B 1km header file  
       t1.09084.1512.1000m.img
          MODIS extracted Level 1B 1km binary image file
       t1.09084.1512.250m.hdr
          MODIS extracted Level 1B 250m header file
       t1.09084.1512.250m.img
          MODIS extracted Level 1B 250m binary image file
       t1.09084.1512.met.hdr
          MODIS extracted Level 1B met header file 
       t1.09084.1512.met.img
          MODIS extracted Level 1B met binary image file (scan type and mirror side info)
       t1.09084.1512.geo.hdr
          MODIS extracted geolocation header file
       t1.09084.1512.geo.img
          MODIS extracted geolocation binary image file

       Since these test output files were created on a
       LITTLE ENDIAN machine,  direct comparison between files created on
       BIG ENDIAN machines cannot be done unless the test output
       file bytes are flipped. In addition, platform and compiler
       differences may cause variations to exist.

       Direct comparison can be attempted by creating a
       flatfile/benchmark directory and copying the example files into
       it. From where your output files are located type (as an example,
       they are in the flatfile/src directory):
       diff t1.09084.1512.1000m.hdr ../benchmark/t1.09084.1512.1000m.hdr
       cmp t1.09084.1512.1000m.img ../benchmark/t1.09084.1512.1000m.img
       diff t1.09084.1512.500m.hdr ../benchmark/t1.09084.1512.500m.hdr
       cmp t1.09084.1512.500m.img ../benchmark/t1.09084.1512.500m.img
       diff t1.09084.1512.250m.hdr ../benchmark/t1.09084.1512.250m.hdr
       cmp t1.09084.1512.250m.img ../benchmark/t1.09084.1512.250m.img
       diff t1.09084.1512.geo.hdr ../benchmark/t1.09084.1512.geo.hdr
       cmp t1.09084.1512.geo.img ../benchmark/t1.09084.1512.geo.img
       diff t1.09084.1512.met.hdr ../benchmark/t1.09084.1512.met.hdr
       cmp t1.09084.1512.met.img ../benchmark/t1.09084.1512.met.img
